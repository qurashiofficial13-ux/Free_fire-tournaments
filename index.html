<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>QURASHI Tournaments â€” Free Fire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="QURASHI Tournaments â€” Free Fire tournaments with entry fees, prizes, JazzCash and WhatsApp support." />
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#0f172a; --muted:#6b7280;
      --brand:#ff6a00; --brand        time: "19:30",
        prizePool: 15000,
        maxTeams: 32,
        registered: 12,
        platform: "Garena Free Fire (OB43)",
        region: "Pakistan + India",
        banner: "https://images.unsplash.com/photo-1553481187-be93c21490a9?q=80&w=1600&auto=format&fit=crop",
      },
    ];

    const $ = sel => document.querySelector(sel);
    const grid = $("#grid");
    const empty = $("#empty");
    const q = $("#q");
    const mode = $("#mode");
    const year = $("#year");
    year.textContent = new Date().getFullYear();

    // Leaderboard (sample)
    const lbData = [
      { team: "A1 Warriors", points: 78, wins: 3 },
      { team: "NoCap Duo", points: 64, wins: 2 },
      { team: "Karachi Kings", points: 59, wins: 1 },
      { team: "Delhi Demons", points: 48, wins: 1 },
      { team: "Lahore Legends", points: 41, wins: 0 },
    ];
    const lb = $("#lb");
    lb.innerHTML = lbData.map((r,i)=>`<tr><td>${i+1}</td><td>${r.team}</td><td>${r.points}</td><td>${r.wins}</td></tr>`).join("");

    // ---------- State ----------
    let tournaments = JSON.parse(localStorage.getItem(S_TOURNEYS) || "null") || seeds;
    let registrations = JSON.parse(localStorage.getItem(S_REGS) || "[]");

    function saveState(){
      localStorage.setItem(S_TOURNEYS, JSON.stringify(tournaments));
      localStorage.setItem(S_REGS, JSON.stringify(registrations));
    }

    // ---------- Rendering ----------
    function spotsLeft(t){ return t.maxTeams - t.registered; }

    function cardHTML(t){
      const left = spotsLeft(t);
      const leftCls = left>0 ? "ok" : "bad";
      const leftText = left>0 ? `${left} spots left` : "Full";
      return `
        <article class="card">
          <div class="banner"><img alt="${t.title}" src="${t.banner}"></div>
          <div class="pad">
            <div class="row" style="margin-bottom:4px">
              <h3 style="margin:0;font-size:18px">${t.title}</h3>
              <span class="chip">${t.mode}</span>
            </div>
            <div class="meta">
              <div>ğŸ“… ${t.date} â€¢ ${t.time}</div>
              <div>ğŸ† PKR ${Number(t.prizePool||0).toLocaleString()}</div>
              <div>ğŸ‘¥ ${t.registered}/${t.maxTeams}</div>
            </div>
            <div class="muted" style="margin-top:6px">${t.platform || "Free Fire"} â€¢ ${t.region || "Open"}</div>
            <div class="row" style="margin-top:10px">
              <span class="${leftCls}" style="font-weight:700;font-size:13px">${leftText}</span>
              <button class="btn brand" ${left<=0?"disabled":""} onclick="openRegister('${t.id}')">Register</button>
            </div>
          </div>
        </article>
      `;
    }

    function render(){
      const txt = (q.value || "").trim().toLowerCase();
      const m = mode.value;
      const list = tournaments.filter(t=>{
        const inQ = !txt || t.title.toLowerCase().includes(txt) || t.mode.toLowerCase().includes(txt) || (t.region||"").toLowerCase().includes(txt);
        const inM = m === "All" || t.mode.toLowerCase().includes(m.toLowerCase());
        return inQ && inM;
      });
      grid.innerHTML = list.map(cardHTML).join("");
      empty.style.display = list.length? "none":"block";
    }

    q.addEventListener("input", render);
    mode.addEventListener("change", render);

    // ---------- Register flow ----------
    const regDialog = document.getElementById("regDialog");
    const regTitle = document.getElementById("regTitle");
    const fTeam = document.getElementById("fTeam");
    const fCaptain = document.getElementById("fCaptain");
    const fPhone = document.getElementById("fPhone");
    const fEmail = document.getElementById("fEmail");
    const fIds = document.getElementById("fIds");
    const submitReg = document.getElementById("submitReg");
    let regTournamentId = null;

    window.openRegister = function(id){
      const t = tournaments.find(x=>x.id===id);
      if(!t) return;
      regTournamentId = id;
      regTitle.textContent = t.title;
      fTeam.value = fCaptain.value = fPhone.value = fEmail.value = fIds.value = "";
      regDialog.showModal();
    }

    submitReg.addEventListener("click", (e)=>{
      // prevent dialog default submit close if invalid
      if(!fTeam.value.trim() || !fCaptain.value.trim() || !fPhone.value.trim()){
        e.preventDefault();
        alert("Please fill required fields.");
        return;
      }
      const tIndex = tournaments.findIndex(x=>x.id===regTournamentId);
      if(tIndex===-1){ alert("Tournament not found"); return; }
      const t = tournaments[tIndex];
      if(spotsLeft(t)<=0){ e.preventDefault(); alert("Tournament is full."); return; }
      const payload = {
        tournamentId: regTournamentId,
        teamName: fTeam.value.trim(),
        captain: fCaptain.value.trim(),
        phone: fPhone.value.trim(),
        email: fEmail.value.trim(),
        playerIds: fIds.value.trim(),
        createdAt: new Date().toISOString()
      };
      registrations.push(payload);
      tournaments[tIndex].registered = Math.min(t.maxTeams, t.registered + 1);
      saveState();
      render();
      // allow dialog to close normally
      setTimeout(()=>alert("Registration received! We will contact you on WhatsApp/Email."), 0);
    });

    // ---------- Create Tournament ----------
    const btnCreate = document.getElementById("btnCreate");
    const createDialog = document.getElementById("createDialog");
    const createForm = document.getElementById("createForm");

    btnCreate.addEventListener("click", ()=>createDialog.showModal());

    createForm.addEventListener("submit", (e)=>{
      const fd = new FormData(createForm);
      const t = {
        id: crypto.randomUUID(),
        title: (fd.get("title")||"").toString(),
        mode: (fd.get("mode")||"Squad").toString(),
        date: (fd.get("date")||"").toString(),
        time: (fd.get("time")||"").toString(),
        prizePool: Number(fd.get("prize")||0),
        maxTeams: Number(fd.get("max")||0),
        registered: 0,
        platform: "Garena Free Fire",
        region: (fd.get("region")||"Open").toString(),
        banner: (fd.get("banner")||"https://images.unsplash.com/photo-1553481187-be93c21490a9?q=80&w=1600&auto=format&fit=crop").toString(),
      };
      tournaments = [t, ...tournaments];
      saveState();
      render();
      // let dialog close
    });

    // ---------- Footer tools ----------
    document.getElementById("reset").addEventListener("click", ()=>{
      if(confirm("Clear saved tournaments & registrations?")){
        localStorage.removeItem(S_TOURNEYS);
        localStorage.removeItem(S_REGS);
        tournaments = seeds.slice();
        registrations = [];
        render();
        alert("Local data cleared.");
      }
    });

    // ---------- First paint ----------
    render();
  </script>
</body>
  </html>
